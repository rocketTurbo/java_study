##多表查询

面试题：2套经典的4表结构： 1套： 还有1套：oracle scott用户



####1. 准备数据

	1. 表结构
		Student(Sid,Sname,Sage,Ssex) 学生表 
		Teacher(Tid,Tname) 教师表
		Course(Cid,Cname,Tid) 课程表
		SC(Sid,Cid,score) 成绩表
	
	2. 准备数据（mysql）
		-- 建数据库
	    create database sql_test;
	    use  sql_test;
	
		-- 建表
		create table student  (sid  int(4) primary key, sname  varchar(20),
				sage int(4), ssex  varchar(2)
		);
		
		create table teacher (tid  int(4)   primary key, tname  varchar(20));
		create table course   (cid  int(4)  primary key , cname  varchar(20), tid  int(4),
		    foreign key(tid) references  teacher(tid)
		 );
		 
		create table sc  (sid  int(4), cid int(4),score int, 
		     foreign key(sid) references student(sid),
		      foreign key(cid) references  course(cid)
		 );
		
		-- 插入数据
		insert into student values(1001, "小明1",21,"男");
		insert into student values(1002, "小明2",22,"女");
		insert into student values(1003, "小明3",23,"男");
		insert into student values(1004, "小明4",24,"女");
		insert into student values(1005, "小明5",25,"男");
		insert into student values(1006, "小明6",26,"女");
		insert into student values(1007, "小明7",29,"女");
	    
		insert into teacher values(2001,"叶平");
		insert into teacher values(2002,"石头");
		insert into teacher values(2003,"叶大大");
		insert into teacher values(2004,"子媚叶");
	
		
		insert into course values(3001,"html",2001);
		insert into course values(3002,"css",2001);
		insert into course values(3003,"js",2002);
		insert into course values(3004,"jquery",2003);	
		
		insert into sc values (1001,3001,80);
		insert into sc values (1001,3002,45);
	
	
		insert into sc values (1002,3001,82);
		insert into sc values(1002,3002,60);
		insert into sc values (1002,3003,89);
		insert into sc values (1002,3004,85);
	
		insert into sc values (1003,3001,45);
		insert into sc values(1003,3002,91);
		
		insert into sc values(1004,3001,76);
		insert into sc values (1004,3003,97);
		
		insert into sc values (1005,3001,66);
		insert into sc values (1005,3002,79);
	
		insert into sc values (1006,3001,77);
		insert into sc values(1006,3003,83);
		
		insert into sc values(1007,3003,56);
		insert into sc values(1007,3004,46);

####2. 基本功



	1.	开展下面学习的前，完成这个查询：
		* 查询所有同学的学号、姓名、选课数、总成绩
		
	* 查询所有同学的学号、选课数、总成绩
		select sid, count(*) , sum(score) from sc group by sid
		
		
		Student(Sid,Sname,Sage,Ssex) 学生表 
		Teacher(Tid,Tname) 教师表
		Course(Cid,Cname,Tid) 课程表
		SC(Sid,Cid,score) 成绩表	

####3. 多表查询技巧
	1. 多表查询
		a. 理论
			* 两个表先进行交叉查询，即产生笛卡尔积。
			* 确定两表连接条件，即去掉笛卡尔积错误的数据。即形成了一张数据更加丰富的大表。
			* 把这个大表，看作是一个单表。在这个基础上，增加筛选条件。
	
		b. 解题的出发点（倒推法）
			* 第一步：需要一张有那些数据的大表，就可以解决问题。
			* 第二步：如何形成这么一张表
	
		c. 经典案例
			* 查询“html”课程比“css”课程成绩高的所有学生的学号。
	
	2. 掌握子查询的结果分类(必须理解)
		a. 理论
			(1) 子查询结果是一个表
				* 结果放在from之后，取一个别名，作为一个虚拟表使用
	
			(2) 子查询结果是一列记录（最麻烦）
	   			* 结果放在where之后，做为条件处理, 注意：结果相当于一个集合，不能使用“=”，而应该使用“in”, "not in"这些方式。
	   	
			(3) 子查询结果是一个值（最简单）
	     		* 子查询放在where之后，做为条件处理  
	
		b. 经典案例
			* 查询学过“叶平”老师课的同学的学号、姓名；
	
	3. 反向思维
		a. 理论
			* 如果正向思维，不好处理。就反向思维来处理
	
		b. 经典案例
			* 查询没学过“叶平”老师课的同学的学号、姓名；
			
			
			
			* 查询没有学全所有课的同学的学号、姓名；
		
	
	4. 正确理解题意
		a. 理论
			* 把查询要求，多读几遍，正确理解题目的意思
	
		b. 经典案例
			* 查询所有课程成绩小于80分的同学的学号、姓名；
	       反向思维
	       
	       先查：有一门课程成绩，大于等于80分的所有学生的学号
	       
	       select distinct  sid from sc where score >=80;  X
	       
	       我们所查询的学生，应该不在集合X里面。
			
		
	5. 训练逻辑能力
		a. 理论
			* 挑战难度，训练逻辑能力
	
		b. 经典案例
			* 查询和“1001”号的同学学习的课程完全相同的其他同学学号和姓名；
			例如：1001号，同学，学习了html ,css
			
			查询的要求：学生学了2门课（课程数和1001号学生相同），并且也是学习了html,css(完全相同)
			
			
			a. 查询一组学生，满足条件：选课的数量和1001学员相同  X
			//1 查询和1001学员选课数量   
			
			// 查询选课数量相同 
			 group by sid having(*) =x; 
			 
			 b. 查询一组学生，其学习了1001号学员没有学过的课  Y
			 
			 例如：我们现在有4门课：html, css, js,jquery ,1001学了html, css    没有学过js,jquery 
			
			
			C. 最后的结果是：
			符合条件的学员，在集合X里面，不在集合Y里面。
			
			

####4. 练习题

	1. 难度1级：
		* 查询平均成绩大于70分的同学的学号和平均成绩；
		* 查询姓“叶”的老师的个数；
		* 查询学过“css”并且也学过编号“3001”课程的同学的学号、姓名；
		* 查询两门及以上不及格课程的同学的学号及其平均成绩
		* 查询每门课程的平均成绩，结果按平均成绩升序排列，平均成绩相同时，按课程号降序排列
		* 查询课程编号“3001”的成绩比课程编号“3002”课程低的所有同学的学号、姓名；
		* 查询至少有一门课与学号为“1001”的同学所学相同的同学的学号和姓名；
		
	
	2. 难度2级：
		* 查询学过“叶平”老师所教的所有课的同学的学号、姓名；
		* 查询选修“叶平”老师所授课程的学生中，成绩最高的5名学生姓名及其成绩
		* 查询所有的课程，并按照及格率的百分数从高到低顺序排列
		
	3. 难度3级：
		* 查询至少学过学号为“1001”同学所有课的其他同学学号和姓名(提示：左外联接)
